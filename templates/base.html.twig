<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{% block title %}TimeCapsule{% endblock %}</title>

        <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

        <style>
            .btn-ghost:hover { background-color: rgba(0,0,0,0.05); color: var(--primary) !important; }
            .hover-primary:hover { color: var(--primary) !important; }
            :root {
                --primary: #2563eb;       /* Bleu Roi */
                --primary-dark: #1d4ed8;
                --text-dark: #1e293b;
                --bg-light: #f8fafc;
            }

            body {
                background-color: var(--bg-light);
                font-family: 'Poppins', sans-serif;
                color: var(--text-dark);
                overflow-x: hidden;
            }

            /* --- NAVBAR --- */
            .navbar {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(12px);
                border-bottom: 1px solid rgba(0,0,0,0.04);
                padding: 0.8rem 0;
            }

            /* LOGO */
            .logo-box {
                background: var(--primary);
                width: 42px;
                height: 42px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
            }
            .logo-text { font-family: 'Rajdhani', sans-serif; line-height: 1; }

            /* BOUTONS NAVIGATION (Menu Principal) */
            .nav-btn {
                border-radius: 50px; /* Pill shape */
                padding: 0.5rem 1.2rem;
                font-weight: 600;
                font-size: 0.9rem;
                transition: all 0.2s ease;
                border: 1px solid transparent;
            }

            /* État Inactif (Gris clair) */
            .nav-btn-inactive {
                background-color: transparent;
                color: #64748b; /* Gris texte */
            }
            .nav-btn-inactive:hover {
                background-color: #f1f5f9; /* Gris très léger au survol */
                color: var(--primary);
            }

            /* État Actif (Bleu) */
            .nav-btn-active {
                background-color: var(--primary);
                color: white;
                box-shadow: 0 4px 10px rgba(37, 99, 235, 0.25);
            }
            .nav-btn-active:hover {
                background-color: var(--primary-dark);
                color: white;
            }

            /* Bouton Admin (Jaune) */
            .btn-admin {
                background: #ffbe0b;
                color: #000;
                font-weight: 700;
                border: none;
                box-shadow: 0 4px 10px rgba(255, 190, 11, 0.2);
            }
            .btn-admin:hover { background: #f5b301; transform: translateY(-1px); }

            /* Dropdown User */
            .user-pill {
                background: white;
                border: 1px solid #e2e8f0;
                padding: 0.4rem 1rem;
                border-radius: 50px;
                font-weight: 500;
                font-size: 0.9rem;
                color: var(--text-dark);
                box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            }

            /* Cartes (utilisées dans le reste du site) */
            .soft-card {
                background: white;
                border: 1px solid rgba(226, 232, 240, 0.8);
                border-radius: 20px;
                box-shadow: 0 10px 30px -10px rgba(0,0,0,0.05);
            }
        </style>
        {% block stylesheets %}{% endblock %}
    </head>
    <body>

        {# On récupère le nom de la route actuelle pour savoir où on est #}
        {% set route_name = app.request.attributes.get('_route') %}

        <nav class="navbar navbar-expand-lg navbar-light fixed-top">
            <div class="container">

                <a class="navbar-brand d-flex align-items-center gap-3" href="{{ path('app_home') }}">
                    <div class="logo-box text-white">
                        <i class="fas fa-meteor"></i>
                    </div>
                    <div class="logo-text d-none d-sm-block">
                        <div class="fw-bold text-dark fs-5" style="letter-spacing: 0.5px;">
                            TIME<span style="color: var(--primary)">CAPSULE</span>
                        </div>
                    </div>
                </a>

                <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navContent">
                    <ul class="navbar-nav ms-auto align-items-center gap-2 mt-3 mt-lg-0">

                        {% if app.user %}

                            {% if 'ROLE_ADMIN' in app.user.roles %}
                                <li class="nav-item me-lg-3">
                                    <a href="{{ path('admin') }}" class="btn btn-admin btn-sm rounded-pill px-3">
                                        <i class="fas fa-crown me-1"></i> Panel
                                    </a>
                                </li>
                            {% endif %}

                            <li class="nav-item">
                                <a href="{{ path('app_capsule_index') }}"
                                   class="nav-btn {{ route_name == 'app_capsule_index' ? 'nav-btn-active' : 'nav-btn-inactive' }}">
                                   <i class="fas fa-layer-group me-1"></i> Mes Capsules
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="{{ path('app_capsule_new') }}"
                                   class="nav-btn {{ route_name == 'app_capsule_new' ? 'nav-btn-active' : 'nav-btn-inactive' }}">
                                    <i class="fas fa-plus me-1"></i> Nouvelle
                                </a>
                            </li>

                            <li class="nav-item dropdown ms-lg-3 ps-lg-3 border-start">
                                <a class="nav-link user-pill dropdown-toggle d-flex align-items-center gap-2" href="#" data-bs-toggle="dropdown">
                                    <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 28px; height: 28px;">
                                        <i class="fas fa-user text-primary" style="font-size: 0.8rem;"></i>
                                    </div>
                                    <span class="d-inline-block text-truncate" style="max-width: 120px;">{{ app.user.email }}</span>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg rounded-4 mt-2 p-2">
                                    <li><a class="dropdown-item rounded-3 text-danger fw-bold" href="{{ path('app_logout') }}">
                                        <i class="fas fa-sign-out-alt me-2"></i>Déconnexion
                                    </a></li>
                                </ul>
                            </li>

                        {% else %}
                            <a href="{{ path('app_login') }}"
                                class="btn {{ app.request.get('_route') == 'app_login' ? 'btn-primary shadow-sm' : 'btn-ghost text-muted hover-primary' }} rounded-pill px-4 fw-bold transition-3d">
                                Se connecter
                            </a>

                            <a href="{{ path('app_register') }}"
                                class="btn {{ app.request.get('_route') == 'app_register' ? 'btn-primary shadow-sm' : 'btn-light text-primary border' }} rounded-pill px-4 fw-bold transition-3d">
                                Inscription
                            </a>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container" style="margin-top: 120px; padding-bottom: 50px;">
            {% for label, messages in app.flashes %}
    {% for message in messages %}
        <div class="alert alert-{{ label == 'error' ? 'danger' : 'success' }} alert-dismissible fade show border-0 shadow-sm rounded-4 mb-4 d-flex align-items-center gap-3" role="alert">
            <i class="fas {{ label == 'error' ? 'fa-exclamation-circle' : 'fa-check-circle' }} fs-5"></i>

            <div class="flex-grow-1">{{ message }}</div>

            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
{% endfor %}

            {% block body %}{% endblock %}
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
